<% content_for :title, "Admin — #{@event.title}" %>

<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="mb-0">Examen de l'événement</h2>
  <%= link_to "← Liste", admin_event_submissions_path, class: "btn btn-outline-secondary btn-sm" %>
</div>

<%# Statut actuel %>
<div class="mb-4">
  <% if @event.validated.nil? %>
    <span class="badge bg-warning text-dark fs-6">⏳ En attente de validation</span>
  <% elsif @event.validated? %>
    <span class="badge bg-success fs-6">✅ Validé</span>
  <% else %>
    <span class="badge bg-danger fs-6">❌ Refusé</span>
  <% end %>
</div>

<div class="row g-4">
  <%# Photo %>
  <% if @event.photo.attached? %>
    <div class="col-12">
      <%= image_tag @event.photo, class: "img-fluid rounded", style: "max-height: 300px; object-fit: cover; width: 100%;" %>
    </div>
  <% end %>

  <%# Détails %>
  <div class="col-md-8">
    <div class="card border-secondary">
      <div class="card-body">
        <h3 class="card-title text-warning"><%= @event.title %></h3>
        <p class="card-text"><%= @event.description %></p>
        <dl class="row mt-3">
          <dt class="col-sm-4 text-muted">Organisateur</dt>
          <dd class="col-sm-8"><%= @event.user.email %></dd>

          <dt class="col-sm-4 text-muted">Date de début</dt>
          <dd class="col-sm-8"><%= @event.start_date.strftime("%d/%m/%Y à %H:%M") %></dd>

          <dt class="col-sm-4 text-muted">Durée</dt>
          <dd class="col-sm-8"><%= @event.duration %> min</dd>

          <dt class="col-sm-4 text-muted">Lieu</dt>
          <dd class="col-sm-8"><%= @event.location %></dd>

          <dt class="col-sm-4 text-muted">Prix</dt>
          <dd class="col-sm-8"><%= @event.price == 0 ? "Gratuit" : "#{@event.price} €" %></dd>

          <dt class="col-sm-4 text-muted">Soumis le</dt>
          <dd class="col-sm-8"><%= @event.created_at.strftime("%d/%m/%Y à %H:%M") %></dd>
        </dl>
      </div>
    </div>
  </div>

  <%# Décision %>
  <div class="col-md-4">
    <div class="card border-warning">
      <div class="card-header bg-transparent border-warning">
        <strong>Décision de modération</strong>
      </div>
      <div class="card-body d-flex flex-column gap-3">
        <%= button_to "✅ Valider l'événement", admin_event_submission_path(@event),
            method: :patch,
            params: { decision: "validate" },
            data: { turbo_confirm: "Valider « #{@event.title} » et notifier l'organisateur ?" },
            class: "btn btn-success w-100" %>

        <%= button_to "❌ Refuser l'événement", admin_event_submission_path(@event),
            method: :patch,
            params: { decision: "reject" },
            data: { turbo_confirm: "Refuser « #{@event.title} » et notifier l'organisateur ?" },
            class: "btn btn-danger w-100" %>
      </div>
    </div>
  </div>
</div>

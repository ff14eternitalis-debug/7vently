<% content_for :title, "Admin — Utilisateurs" %>

<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="mb-0">Utilisateurs <span class="badge bg-secondary"><%= @users.count %></span></h2>
  <%= link_to "← Dashboard", admin_root_path, class: "btn btn-outline-secondary btn-sm" %>
</div>

<div class="table-responsive">
  <table class="table table-dark table-hover table-bordered align-middle">
    <thead class="table-warning text-dark">
      <tr>
        <th>ID</th>
        <th>Nom</th>
        <th>Email</th>
        <th>Admin</th>
        <th>Inscrit le</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% @users.each do |user| %>
        <tr>
          <td class="text-muted small"><%= user.id %></td>
          <td>
            <% if user.avatar.attached? %>
              <%= image_tag user.avatar, class: "rounded-circle me-2", width: 28, height: 28, style: "object-fit: cover;" %>
            <% else %>
              <img src="https://api.dicebear.com/9.x/avataaars/svg?seed=<%= user.email %>" width="28" height="28" class="rounded-circle me-2" alt="Avatar">
            <% end %>
            <%= user.first_name.presence || "" %> <%= user.last_name.presence || "" %>
          </td>
          <td><%= user.email %></td>
          <td>
            <% if user.admin? %>
              <span class="badge bg-warning text-dark">Admin</span>
            <% else %>
              <span class="badge bg-secondary">Utilisateur</span>
            <% end %>
          </td>
          <td class="text-muted small"><%= user.created_at.strftime("%d/%m/%Y") %></td>
          <td>
            <div class="d-flex gap-1">
              <%= link_to "Voir", admin_user_path(user), class: "btn btn-outline-light btn-sm" %>
              <%= link_to "Modifier", edit_admin_user_path(user), class: "btn btn-outline-warning btn-sm" %>
              <% unless user == current_user %>
                <%= button_to "Supprimer", admin_user_path(user), method: :delete, data: { turbo_confirm: "Supprimer #{user.email} ?" }, class: "btn btn-outline-danger btn-sm" %>
              <% end %>
            </div>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
